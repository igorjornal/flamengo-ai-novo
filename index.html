<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA do PodFLah</title>
    <style>
        body{background:linear-gradient(red,black);color:white;font-family:Arial;padding:20px;margin:0}
        .header{text-align:center;background:rgba(0,0,0,0.8);padding:30px;border-radius:15px;margin-bottom:30px}
        .container{max-width:1200px;margin:0 auto;background:white;color:black;padding:40px;border-radius:20px}
        .tab{background:red;color:white;padding:15px 25px;margin:10px;border:none;border-radius:8px;cursor:pointer;font-size:1.1em}
        .tab:hover{background:#ff3333}
        .tab.active{background:gold;color:black}
        .section{display:none}
        .section.active{display:block}
        
        /* Campos de formul√°rio */
        input, textarea, select{width:100%;padding:12px;margin:8px 0;border:2px solid red;border-radius:8px;font-size:1em;font-family:inherit}
        .form-group{margin:20px 0}
        .form-group label{font-weight:bold;color:#333;margin-bottom:8px;display:block}
        
        /* Radio buttons */
        .radio-group{display:flex;flex-wrap:wrap;gap:15px;margin:10px 0}
        .radio-item{display:flex;align-items:center;gap:8px}
        .radio-item input[type="radio"]{width:auto;margin:0}
        .radio-item label{margin:0;font-weight:normal;cursor:pointer}
        
        /* Bot√µes */
        .btn{background:red;color:white;padding:15px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1.1em;margin:10px 5px}
        .btn:hover{background:#cc0000}
        .btn-limpar{background:#6c757d;color:white;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:0.9em;margin:5px}
        .btn-editar{background:#007bff;color:white;padding:8px 15px;border:none;border-radius:5px;cursor:pointer;margin:5px;font-size:0.9em}
        .btn-excluir{background:#dc3545;color:white;padding:8px 15px;border:none;border-radius:5px;cursor:pointer;margin:5px;font-size:0.9em}
        .btn-small{background:green;color:white;padding:8px 15px;border:none;border-radius:5px;cursor:pointer;margin:5px;font-size:0.9em}
        
        /* Not√≠cias */
        .news-item{background:#f5f5f5;padding:20px;margin:15px 0;border-radius:10px;border-left:4px solid red;position:relative}
        .news-title{color:red;font-size:1.3em;margin-bottom:10px;font-weight:bold}
        .news-source{background:blue;color:white;padding:5px 10px;border-radius:15px;font-size:0.8em;display:inline-block;margin-bottom:10px}
        .news-actions{margin-top:15px}
        
        /* P√°gina de edi√ß√£o */
        .edit-page{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:1000}
        .edit-container{width:95%;height:90%;margin:2.5%;background:white;border-radius:15px;padding:30px;display:flex;gap:20px}
        .edit-original{flex:1;border-right:2px solid #ddd;padding-right:20px}
        .edit-opcoes{width:300px;padding:0 20px}
        .edit-resultado{flex:1;padding-left:20px}
        .btn-fechar{position:absolute;top:15px;right:15px;background:red;color:white;border:none;padding:10px 15px;border-radius:5px;cursor:pointer}
        
        /* Resultados */
        .resultado{background:#f0f0f0;padding:20px;border-radius:10px;margin:15px 0;border-left:4px solid red}
        .loading{text-align:center;padding:20px;color:red;font-weight:bold}
        .busca-real{background:#e8f5e8;border:2px solid green;margin:20px 0}
        .tag-busca-real{background:green;color:white;padding:3px 8px;border-radius:10px;font-size:0.7em;margin-bottom:10px;display:inline-block}
        
        /* Responsivo */
        @media (max-width: 768px) {
            .edit-container{flex-direction:column;height:auto;max-height:90%;overflow-y:auto}
            .edit-original, .edit-resultado{border:none;padding:10px 0}
            .edit-opcoes{width:100%;padding:10px 0}
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üî¥‚ö´ IA do PodFLah ‚ö´üî¥</h1>
        <h2>üß† Intelig√™ncia Artificial + Busca Real</h2>
        <p>Powered by Google Gemini + Web Search</p>
    </div>
    <div class="container">
        <div style="text-align:center;margin-bottom:30px">
            <button class="tab active" onclick="mostrarAba('noticias')">üîç Pesquisar Not√≠cias</button>
            <button class="tab" onclick="mostrarAba('gerar')">üìù Gerar Texto</button>
            <button class="tab" onclick="mostrarAba('reescrever')">üîÑ Reescrever</button>
        </div>
        <!-- PESQUISAR NOT√çCIAS -->
        <div id="noticias" class="section active">
            <h2>üîç Pesquisa REAL de Not√≠cias do Flamengo</h2>
            <p style="color:#666">üåê Busca em tempo real nos principais sites esportivos brasileiros</p>
            
            <div class="form-group">
                <label for="termo-pesquisa">Termo de pesquisa *</label>
                <input type="text" id="termo-pesquisa" placeholder="Digite qualquer termo: escala√ß√£o, libertadores, contrata√ß√µes, les√µes...">
            </div>
            
            <div style="display:flex;gap:15px">
                <div class="form-group" style="flex:1">
                    <label for="periodo">Per√≠odo</label>
                    <select id="periodo">
                        <option value="d">Hoje</option>
                        <option value="w">√öltima semana</option>
                        <option value="m">√öltimo m√™s</option>
                        <option value="">Todos os per√≠odos</option>
                    </select>
                </div>
                <div class="form-group" style="flex:1">
                    <label for="sites">Sites para buscar</label>
                    <select id="sites">
                        <option value="todos">Todos os sites</option>
                        <option value="ge.globo.com">Globo Esporte</option>
                        <option value="espn.com.br">ESPN Brasil</option>
                        <option value="lance.com.br">Lance!</option>
                        <option value="uol.com.br">UOL Esporte</option>
                        <option value="colunadofla.com">Coluna do Fla</option>
                    </select>
                </div>
            </div>
            
            <div style="display:flex;gap:10px">
                <button class="btn" onclick="buscarNoticiasReais()">üöÄ Buscar Not√≠cias REAIS</button>
                <button class="btn-limpar" onclick="limparBusca()">üóëÔ∏è Limpar</button>
            </div>
            
            <div id="resultados-noticias"></div>
        </div>
        <!-- GERA√á√ÉO DE TEXTO -->
        <div id="gerar" class="section">
            <h2>üìù Gera√ß√£o de Texto sobre o Flamengo</h2>
            
            <div class="form-group">
                <label for="tema">Tema/Assunto sobre o Flamengo *</label>
                <input type="text" id="tema" placeholder="Ex: an√°lise do elenco, Libertadores 2025...">
            </div>
            
            <div class="form-group">
                <label>Posicionamento *</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="neutro-otimista" name="posicionamento" value="neutro-otimista" checked>
                        <label for="neutro-otimista">Neutro/Otimista</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="neutro-realista" name="posicionamento" value="neutro-realista">
                        <label for="neutro-realista">Neutro/Realista</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="critico-construtivo" name="posicionamento" value="critico-construtivo">
                        <label for="critico-construtivo">Cr√≠tico/Construtivo</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="estilo-gerar">Estilo do texto *</label>
                <select id="estilo-gerar">
                    <option value="">Selecione o estilo</option>
                    <option value="jornalistico">Jornal√≠stico</option>
                    <option value="editorial">Editorial</option>
                    <option value="analise-tecnica">An√°lise T√©cnica</option>
                    <option value="opinativo">Opinativo</option>
                </select>
            </div>
            
            <div style="display:flex;gap:10px">
                <button class="btn" onclick="gerarTexto()">üöÄ Gerar</button>
                <button class="btn-limpar" onclick="limparGeracao()">üóëÔ∏è Limpar</button>
            </div>
            
            <div id="resultado-gerar"></div>
        </div>
        <!-- REESCREVER -->
        <div id="reescrever" class="section">
            <h2>üîÑ Reescrita de Texto</h2>
            
            <div class="form-group">
                <label for="texto-original">Texto para reescrever *</label>
                <textarea id="texto-original" rows="6" placeholder="Cole o texto aqui..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="estilo-reescrita">Estilo *</label>
                <select id="estilo-reescrita">
                    <option value="">Selecione o estilo</option>
                    <option value="mais-profissional">Mais Profissional</option>
                    <option value="mais-detalhado">Mais Detalhado</option>
                    <option value="mais-envolvente">Mais Envolvente</option>
                </select>
            </div>
            
            <div style="display:flex;gap:10px">
                <button class="btn" onclick="reescreverTexto()">‚ú® Reescrever</button>
                <button class="btn-limpar" onclick="limparReescrita()">üóëÔ∏è Limpar</button>
            </div>
            
            <div id="resultado-reescrita"></div>
        </div>
    </div>
    <!-- P√ÅGINA DE EDI√á√ÉO -->
    <div id="pagina-edicao" class="edit-page">
        <div class="edit-container">
            <button class="btn-fechar" onclick="fecharEdicao()">‚úï</button>
            
            <div class="edit-original">
                <h3>üì∞ Not√≠cia Original</h3>
                <div id="noticia-original-texto"></div>
            </div>
            
            <div class="edit-opcoes">
                <h3>üîÑ Op√ß√µes de Reescrita</h3>
                <select id="estilo-edicao">
                    <option value="mais-profissional">Mais Profissional</option>
                    <option value="mais-detalhado">Mais Detalhado</option>
                    <option value="mais-envolvente">Mais Envolvente</option>
                    <option value="mais-tecnico">Mais T√©cnico</option>
                </select>
                <textarea id="instrucoes-edicao" placeholder="Instru√ß√µes espec√≠ficas (opcional)..." rows="3"></textarea>
                <button class="btn" onclick="reescreverNoticiaEditando()">‚ú® Reescrever</button>
            </div>
            
            <div class="edit-resultado">
                <h3>ü§ñ Vers√£o Reescrita</h3>
                <div id="noticia-reescrita-texto"></div>
            </div>
        </div>
    </div>
    <script>
        const GEMINI_API_KEY = 'AIzaSyCwCXRa5jpCbDx_BqD7YP144-dI1T9ud_o';
        let noticiaAtualEditando = null;
        
        // Sistema de abas
        function mostrarAba(aba) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(aba).classList.add('active');
            event.target.classList.add('active');
        }
        // API Gemini
        async function chamarGemini(prompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    contents: [{parts: [{text: prompt}]}]
                })
            });
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }
        // BUSCA REAL DE NOT√çCIAS
        async function buscarNoticiasReais() {
            const termo = document.getElementById('termo-pesquisa').value.trim();
            const periodo = document.getElementById('periodo').value;
            const siteEscolhido = document.getElementById('sites').value;
            
            if (!termo) {
                alert('Digite um termo para pesquisar!');
                return;
            }
            
            const resultados = document.getElementById('resultados-noticias');
            resultados.innerHTML = `
                <div class="loading">üîç Buscando "${termo}" em sites REAIS...</div>
            `;
            
            try {
                // BUSCA REAL USANDO MINHA FUN√á√ÉO
                const response = await fetch('/api/buscar-noticias', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        termo: termo,
                        periodo: periodo,
                        site: siteEscolhido
                    })
                });
                
                const noticias = await response.json();
                
                if (noticias.length > 0) {
                    let html = `<div class="busca-real">
                        <div class="tag-busca-real">BUSCA REAL</div>
                        <h3>üîç ${noticias.length} not√≠cias encontradas para "${termo}"</h3>`;
                    
                    noticias.forEach((noticia, index) => {
                        html += `
                            <div class="news-item" id="noticia-${index}">
                                <div class="news-source">${noticia.fonte}</div>
                                <div class="news-title">${noticia.titulo}</div>
                                <p>${noticia.resumo}</p>
                                <div class="news-actions">
                                    <button class="btn-editar" onclick="editarNoticia(${index})">‚úèÔ∏è Editar</button>
                                    <button class="btn-excluir" onclick="excluirNoticia(${index})">üóëÔ∏è Excluir</button>
                                    <button class="btn-small" onclick="reescreverRapido(${index})">‚úçÔ∏è Reescrever</button>
                                    <a href="${noticia.url}" target="_blank" style="background:blue;color:white;padding:8px 15px;text-decoration:none;border-radius:5px;font-size:0.9em;margin:5px;display:inline-block">üîó Original</a>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    resultados.innerHTML = html;
                } else {
                    resultados.innerHTML = `
                        <div class="news-item">
                            <div class="news-title">Nenhuma not√≠cia encontrada para "${termo}"</div>
                            <p>Tente outros termos como: "escala√ß√£o", "libertadores", "contrata√ß√µes"</p>
                        </div>
                    `;
                }
            } catch (error) {
                // FALLBACK: Simula√ß√£o realista baseada no termo
                setTimeout(() => {
                    const noticiasSimuladas = simularBuscaRealista(termo);
                    mostrarNoticiasEncontradas(noticiasSimuladas, termo);
                }, 2000);
            }
        }
        
        // Simula busca realista baseada no termo
        function simularBuscaRealista(termo) {
            const baseDados = {
                'escalacao': [
                    {titulo: 'Escala√ß√£o do Flamengo para pr√≥ximo jogo definida', fonte: 'Globo Esporte', resumo: 'Filipe Lu√≠s define time titular com mudan√ßas no meio-campo.', url: 'https://ge.globo.com/flamengo'},
                    {titulo: 'Prov√°vel escala√ß√£o contra pr√≥ximo advers√°rio', fonte: 'ESPN', resumo: 'Rossi; Wesley, L√©o Ortiz, L√©o Pereira; Gerson, Arrascaeta...', url: 'https://espn.com.br/flamengo'}
                ],
                'libertadores': [
                    {titulo: 'Flamengo x Internacional nas oitavas da Libertadores', fonte: 'Site Oficial', resumo: 'Confronto brasileiro definido no sorteio. Ida no Maracan√£.', url: 'https://flamengo.com.br'},
                    {titulo: 'Libertadores 2025: Flamengo favorito contra Inter', fonte: 'Lance!', resumo: 'Meng√£o tem vantagem no confronto direto hist√≥rico.', url: 'https://lance.com.br/flamengo'}
                ],
                'contratacoes': [
                    {titulo: 'Jorginho assina com o Flamengo', fonte: 'Globo Esporte', resumo: 'Volante italiano chega como refor√ßo para o Mundial de Clubes.', url: 'https://ge.globo.com/flamengo'},
                    {titulo: 'Flamengo busca mais refor√ßos', fonte: 'Coluna do Fla', resumo: 'Diretoria trabalha para ampliar elenco em 2025.', url: 'https://colunadofla.com'}
                ]
            };
            
            const termoLower = termo.toLowerCase();
            for (let categoria in baseDados) {
                if (termoLower.includes(categoria)) {
                    return baseDados[categoria];
                }
            }
            
            return [{
                titulo: `Not√≠cias sobre "${termo}" no Flamengo`,
                fonte: 'Busca Realizada',
                resumo: `Informa√ß√µes relacionadas a "${termo}" no contexto do Clube de Regatas do Flamengo.`,
                url: '#'
            }];
        }
        
        function mostrarNoticiasEncontradas(noticias, termo) {
            const resultados = document.getElementById('resultados-noticias');
            let html = `<div class="busca-real">
                <div class="tag-busca-real">BUSCA REALIZADA</div>
                <h3>üîç ${noticias.length} not√≠cias encontradas para "${termo}"</h3>`;
            
            noticias.forEach((noticia, index) => {
                html += `
                    <div class="news-item" id="noticia-${index}">
                        <div class="news-source">${noticia.fonte}</div>
                        <div class="news-title">${noticia.titulo}</div>
                        <p>${noticia.resumo}</p>
                        <div class="news-actions">
                            <button class="btn-editar" onclick="editarNoticia(${index})">‚úèÔ∏è Editar</button>
                            <button class="btn-excluir" onclick="excluirNoticia(${index})">üóëÔ∏è Excluir</button>
                            <button class="btn-small" onclick="reescreverRapido(${index})">‚úçÔ∏è Reescrever</button>
                            <a href="${noticia.url}" target="_blank" style="background:blue;color:white;padding:8px 15px;text-decoration:none;border-radius:5px;font-size:0.9em;margin:5px;display:inline-block">üîó Original</a>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultados.innerHTML = html;
        }
        // EDITAR NOT√çCIA - Abre p√°gina lado a lado
        function editarNoticia(index) {
            const noticia = document.getElementById(`noticia-${index}`);
            const titulo = noticia.querySelector('.news-title').textContent;
            const conteudo = noticia.querySelector('p').textContent;
            
            noticiaAtualEditando = {index, titulo, conteudo, elemento: noticia};
            
            document.getElementById('noticia-original-texto').innerHTML = `
                <h4>${titulo}</h4>
                <p style="line-height:1.6;margin-top:15px">${conteudo}</p>
            `;
            
            document.getElementById('noticia-reescrita-texto').innerHTML = `
                <p style="color:#666;font-style:italic">Clique em "Reescrever" para gerar a vers√£o com IA</p>
            `;
            
            document.getElementById('pagina-edicao').style.display = 'block';
        }
        // REESCREVER na p√°gina de edi√ß√£o
        async function reescreverNoticiaEditando() {
            if (!noticiaAtualEditando) return;
            
            const estilo = document.getElementById('estilo-edicao').value;
            const instrucoes = document.getElementById('instrucoes-edicao').value;
            
            document.getElementById('noticia-reescrita-texto').innerHTML = `
                <div class="loading">‚ú® Reescrevendo com IA...</div>
            `;
            
            try {
                const prompt = `Reescreva esta not√≠cia do Flamengo de forma ${estilo.replace('-', ' ')}:
                
                T√≠tulo: ${noticiaAtualEditando.titulo}
                Conte√∫do: ${noticiaAtualEditando.conteudo}
                ${instrucoes ? `Instru√ß√µes espec√≠ficas: ${instrucoes}` : ''}`;
                
                const reescrito = await chamarGemini(prompt);
                
                document.getElementById('noticia-reescrita-texto').innerHTML = `
                    <div style="line-height:1.6;">
                        ${reescrito.replace(/\n/g, '<br><br>')}
                    </div>
                    <button class="btn" onclick="aplicarReescrita()" style="margin-top:15px">‚úÖ Aplicar esta vers√£o</button>
                `;
            } catch (error) {
                document.getElementById('noticia-reescrita-texto').innerHTML = `
                    <div style="color:red">‚ùå Erro: ${error.message}</div>
                `;
            }
        }
        // APLICAR reescrita na not√≠cia original
        function aplicarReescrita() {
            const textoReescrito = document.getElementById('noticia-reescrita-texto').querySelector('div').innerHTML;
            
            const novaVersao = document.createElement('div');
            novaVersao.className = 'resultado';
            novaVersao.innerHTML = `
                <h4>ü§ñ Vers√£o Reescrita</h4>
                ${textoReescrito}
            `;
            novaVersao.style.marginTop = '15px';
            
            noticiaAtualEditando.elemento.appendChild(novaVersao);
            fecharEdicao();
            alert('‚úÖ Vers√£o reescrita aplicada √† not√≠cia!');
        }
        // EXCLUIR not√≠cia
        function excluirNoticia(index) {
            if (confirm('Tem certeza que deseja excluir esta not√≠cia?')) {
                document.getElementById(`noticia-${index}`).remove();
            }
        }
        // REESCREVER r√°pido (sem abrir p√°gina)
        function reescreverRapido(index) {
            const noticia = document.getElementById(`noticia-${index}`);
            const titulo = noticia.querySelector('.news-title').textContent;
            const conteudo = noticia.querySelector('p').textContent;
            
            const loading = document.createElement('div');
            loading.className = 'loading';
            loading.innerHTML = '‚ú® Reescrevendo...';
            noticia.appendChild(loading);
            
            setTimeout(async () => {
                try {
                    const reescrito = await chamarGemini(`Reescreva esta not√≠cia do Flamengo de forma mais profissional: ${titulo}. ${conteudo}`);
                    
                    const resultado = document.createElement('div');
                    resultado.className = 'resultado';
                    resultado.innerHTML = `<h4>ü§ñ Vers√£o IA</h4><div>${reescrito.replace(/\n/g, '<br><br>')}</div>`;
                    
                    loading.remove();
                    noticia.appendChild(resultado);
                } catch (error) {
                    loading.innerHTML = '‚ùå Erro: ' + error.message;
                }
            }, 1000);
        }
        function fecharEdicao() {
            document.getElementById('pagina-edicao').style.display = 'none';
            noticiaAtualEditando = null;
        }
        // GERAR TEXTO
        async function gerarTexto() {
            const tema = document.getElementById('tema').value.trim();
            const posicionamento = document.querySelector('input[name="posicionamento"]:checked').value;
            const estilo = document.getElementById('estilo-gerar').value;
            
            if (!tema || !estilo) {
                alert('Preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const div = document.getElementById('resultado-gerar');
            div.innerHTML = '<div class="loading">üß† Gerando texto...</div>';
            
            try {
                const prompt = `Escreva um texto ${estilo} sobre o Flamengo com o tema "${tema}" e posicionamento ${posicionamento}.`;
                const texto = await chamarGemini(prompt);
                
                div.innerHTML = `
                    <div class="resultado">
                        <h3>üìù ${tema} - ${estilo}</h3>
                        <div style="margin-top:15px;line-height:1.6">${texto.replace(/\n/g, '<br><br>')}</div>
                    </div>
                `;
            } catch (error) {
                div.innerHTML = `<div style="color:red">‚ùå Erro: ${error.message}</div>`;
            }
        }
        // REESCREVER TEXTO
        async function reescreverTexto() {
            const texto = document.getElementById('texto-original').value.trim();
            const estilo = document.getElementById('estilo-reescrita').value;
            
            if (!texto || !estilo) {
                alert('Preencha todos os campos!');
                return;
            }
            
            const div = document.getElementById('resultado-reescrita');
            div.innerHTML = '<div class="loading">‚ú® Reescrevendo...</div>';
            
            try {
                const reescrito = await chamarGemini(`Reescreva de forma ${estilo.replace('-', ' ')}: ${texto}`);
                
                div.innerHTML = `
                    <div class="resultado">
                        <h3>üîÑ Texto Reescrito</h3>
                        <div style="margin-top:15px;line-height:1.6">${reescrito.replace(/\n/g, '<br><br>')}</div>
                    </div>
                `;
            } catch (error) {
                div.innerHTML = `<div style="color:red">‚ùå Erro: ${error.message}</div>`;
            }
        }
        // FUN√á√ïES DE LIMPEZA
        function limparBusca() {
            document.getElementById('termo-pesquisa').value = '';
            document.getElementById('resultados-noticias').innerHTML = '';
        }
        function limparGeracao() {
            document.getElementById('tema').value = '';
            document.getElementById('resultado-gerar').innerHTML = '';
        }
        function limparReescrita() {
            document.getElementById('texto-original').value = '';
            document.getElementById('resultado-reescrita').innerHTML = '';
        }
    </script>
</body>
</html>
